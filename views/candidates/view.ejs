<%- include('../partials/header') %>
<%- include('../partials/sidebar') %>

<!-- Responsive wrapper for Sidebar -->
<div class="lg:ml-64 mt-10 p-4 sm:p-6 md:p-8 bg-gray-100 min-h-screen">

  <div class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 max-w-5xl mx-auto">

    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center border-b pb-4 mb-6 gap-4">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800"><%= candidate.name %></h1>
        <p class="text-gray-500 text-sm">Candidate Resume</p>
      </div>
      <a href="/candidates/list" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-md text-center">
        Back to List
      </a>
    </div>

    <!-- Basic Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700 mb-6">
      <div class="space-y-1">
        <p><strong>Job Applied For:</strong> <%= candidate.job ? candidate.job.title : 'N/A' %></p>
        <p><strong>Email:</strong> <%= candidate.email %></p>
        <p><strong>Contact:</strong> <%= candidate.contactNo || 'N/A' %></p>
        <p><strong>Marital Status:</strong> <%= candidate.maritalStatus || 'N/A' %></p>
      </div>
      <div class="space-y-1">
        <p><strong>Date of Birth:</strong> <%= candidate.dob ? candidate.dob.toISOString().split('T')[0] : 'N/A' %></p>
        <p><strong>Age:</strong> <%= candidate.age || 'N/A' %> years</p>
        <p><strong>Experience:</strong> 
          <%= candidate.fresher ? 'Fresher' : (candidate.experienceYears ? candidate.experienceYears + ' Years' : 'N/A') %>
        </p>
        <p><strong>Address:</strong> <%= candidate.address || 'N/A' %></p>
      </div>
    </div>

    <!-- Experience Section -->
    <div class="border-t pt-6 mt-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Work Experience</h2>

      <% 
        let totalMonths = 0;
        if (candidate.Experiences && candidate.Experiences.length > 0) {
          candidate.Experiences.forEach(exp => {
            const from = exp.from ? new Date(exp.from) : null;
            const to = exp.to ? new Date(exp.to) : new Date();
            if (from) totalMonths += (to.getFullYear() - from.getFullYear()) * 12 + (to.getMonth() - from.getMonth());
          });
          const years = Math.floor(totalMonths / 12);
          const months = totalMonths % 12;
          var totalExperience = `${years} yrs ${months} mos`;
        } else {
          var totalExperience = candidate.fresher ? 'Fresher' : 'N/A';
        }
      %>

      <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
        <p class="font-semibold text-gray-700">Total Experience: <%= totalExperience %></p>
      </div>

      <% if (candidate.Experiences && candidate.Experiences.length > 0) { %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% candidate.Experiences.forEach(exp => { %>
            <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
              <p class="text-gray-800 font-semibold"><%= exp.designation %></p>
              <p class="text-gray-600 mb-1"><%= exp.company %></p>
              <p class="text-sm text-gray-500 mb-1">
                <strong>From:</strong> <%= exp.from ? exp.from.toISOString().split('T')[0] : 'N/A' %> —
                <strong>To:</strong> <%= exp.to ? exp.to.toISOString().split('T')[0] : 'Present' %>
              </p>
              <p><strong>Salary:</strong> ₹<%= exp.salary || 'N/A' %></p>
              <p><strong>Reason for Leaving:</strong> <%= exp.reasonLeaving || 'N/A' %></p>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <p class="text-gray-500 italic">No work experience provided.</p>
      <% } %>
    </div>

    <!-- Education Section -->
    <div class="border-t pt-6 mt-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-3">Educational Qualifications</h2>

      <% if(candidate.Qualifications && candidate.Qualifications.length > 0) { %>
        <div class="overflow-x-auto">
          <table class="w-full border border-gray-300 text-sm text-left min-w-[600px]">
            <thead class="bg-gray-100">
              <tr>
                <th class="border p-2">Course</th>
                <th class="border p-2">Board / University</th>
                <th class="border p-2">Year</th>
                <th class="border p-2">Division</th>
              </tr>
            </thead>
            <tbody>
              <% candidate.Qualifications.forEach(q => { %>
                <tr>
                  <td class="border p-2"><%= q.course %></td>
                  <td class="border p-2"><%= q.board %></td>
                  <td class="border p-2"><%= q.year %></td>
                  <td class="border p-2"><%= q.division %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="text-gray-500 italic">No qualifications available.</p>
      <% } %>
    </div>

    <!-- References -->
    <div class="border-t pt-6 mt-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-3">References</h2>

      <% if (candidate.References && candidate.References.length > 0) { %>
        <div class="overflow-x-auto">
          <table class="w-full border border-gray-300 text-sm text-left min-w-[500px]">
            <thead class="bg-gray-100">
              <tr>
                <th class="border p-2">Name</th>
                <th class="border p-2">Designation</th>
                <th class="border p-2">Company</th>
              </tr>
            </thead>
            <tbody>
              <% candidate.References.forEach(r => { %>
                <tr>
                  <td class="border p-2"><%= r.name %></td>
                  <td class="border p-2"><%= r.designation %></td>
                  <td class="border p-2"><%= r.company %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="text-gray-500 italic">No references added.</p>
      <% } %>
    </div>

    <!-- Skills & Achievements Section -->
    <div class="border-t pt-6 mt-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">Skills & Achievements</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 shadow-sm">
          <h3 class="text-lg font-semibold text-blue-700 mb-2">Key Technical Skills</h3>
          <p class="text-gray-700 leading-relaxed">
            <%= candidate.Questionnaire?.keyTechnicalExpertise || 'Not specified' %>
          </p>
        </div>

        <div class="bg-green-50 border border-green-200 rounded-xl p-4 shadow-sm">
          <h3 class="text-lg font-semibold text-green-700 mb-2">Major Strengths</h3>
          <p class="text-gray-700 leading-relaxed">
            <%= candidate.Questionnaire?.majorStrengths || 'Not specified' %>
          </p>
        </div>

        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 shadow-sm">
          <h3 class="text-lg font-semibold text-yellow-700 mb-2">Achievements</h3>
          <p class="text-gray-700 leading-relaxed">
            <%= candidate.Questionnaire?.majorAchievements || 'Not specified' %>
          </p>
        </div>

      </div>
    </div>

    <!-- Documents -->
    <div class="border-t pt-6 mt-6">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6 2a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6H6zm7 1.5L18.5 9H13V3.5zM8 13h8v2H8v-2zm0 4h8v2H8v-2z"/>
        </svg>
        Uploaded Documents
      </h2>

      <%
        let documents = [];
        if (candidate.documents) {
          documents = typeof candidate.documents === 'string' 
            ? candidate.documents.split(',') 
            : Array.isArray(candidate.documents) 
              ? candidate.documents 
              : [];
        }
      %>

      <% if (documents.length > 0) { %>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
          <% documents.forEach(doc => { %>
            <div class="bg-white shadow-md rounded-xl border border-gray-200 p-4 flex flex-col items-center justify-between hover:shadow-lg transition-shadow duration-300">
              <div class="flex flex-col items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-600 mb-2" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M6 2a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6H6zm7 1.5L18.5 9H13V3.5zM8 13h8v2H8v-2zm0 4h8v2H8v-2z"/>
                </svg>
                <p class="text-sm font-medium text-gray-700 truncate w-40 text-center"><%= doc %></p>
              </div>

              <a href="/uploads/<%= doc %>"
                 target="_blank"
                 class="mt-3 inline-block bg-red-500 text-white text-sm px-4 py-1.5 rounded-lg hover:bg-red-600 transition">
                View PDF
              </a>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <p class="text-gray-500 italic">No documents uploaded.</p>
      <% } %>
    </div>

  </div>
</div>

<%- include('../partials/footer') %>
