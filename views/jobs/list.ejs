<%- include('../partials/header') %>
<%- include('../partials/sidebar') %>

<!-- Responsive Wrapper -->
<div class="lg:ml-64 mt-11 p-4 sm:p-6 md:p-8 bg-gray-100 min-h-screen">

  <h1 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center gap-2">
    <i class="fa-solid fa-briefcase text-blue-600"></i> Manage Jobs
  </h1>

  <a href="/jobs/create" 
     class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 sm:px-5 py-2.5 rounded-lg shadow-md mb-6 inline-flex items-center gap-2 transition duration-200">
      Add Job
  </a>

  <div class="overflow-x-auto bg-white rounded-xl shadow-lg">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-blue-100 text-gray-700">
        <tr>
          <th class="px-4 sm:px-6 py-3 text-left text-xs sm:text-sm font-semibold uppercase">Title</th>
          <th class="px-4 sm:px-6 py-3 text-left text-xs sm:text-sm font-semibold uppercase">Experience</th>
          <th class="px-4 sm:px-6 py-3 text-left text-xs sm:text-sm font-semibold uppercase">Location</th>
          <th class="px-4 sm:px-6 py-3 text-left text-xs sm:text-sm font-semibold uppercase">CTC</th>
          <th class="px-4 sm:px-6 py-3 text-left text-xs sm:text-sm font-semibold uppercase">Description</th>
          <th class="px-4 sm:px-6 py-3 text-left text-xs sm:text-sm font-semibold uppercase">Status</th>
          <th class="px-4 sm:px-6 py-3 text-center text-xs sm:text-sm font-semibold uppercase">Applicants</th>
          <th class="px-4 sm:px-6 py-3 text-center text-xs sm:text-sm font-semibold uppercase">Actions</th>
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-100">
        <% jobs.forEach(job => { %>
          <tr class="hover:bg-gray-50 transition duration-150">
            <td class="px-4 sm:px-6 py-4 text-sm text-gray-800 font-medium"><%= job.title %></td>
            <td class="px-4 sm:px-6 py-4 text-sm text-gray-600"><%= job.experienceLevel %></td>
            <td class="px-4 sm:px-6 py-4 text-sm text-gray-600"><%= job.location %></td>
            <td class="px-4 sm:px-6 py-4 text-sm text-gray-600"><%= job.ctc %></td>

            <!-- Description  -->
            <td 
              class="px-4 sm:px-6 py-4 text-sm text-gray-600 max-w-[150px] sm:max-w-[200px] truncate cursor-pointer hover:text-blue-600 transition"
              onclick="openModal('<%= job.id %>')"
              title="Click to view full description"
            >
              <%= job.description && job.description.length > 60 
                ? job.description.substring(0, 60) + '...' 
                : (job.description || 'â€”') %>
            </td>

            <!-- Status -->
            <td class="px-4 sm:px-6 py-4">
              <% if(job.status === 'Active'){ %>
                <span class="px-2 sm:px-3 py-1 inline-flex text-xs font-semibold rounded-full bg-green-100 text-green-700">
                  <i class="fa-solid fa-check-circle mr-1"></i> Active
                </span>
              <% } else { %>
                <span class="px-2 sm:px-3 py-1 inline-flex text-xs font-semibold rounded-full bg-red-100 text-red-700">
                  <i class="fa-solid fa-xmark-circle mr-1"></i> Inactive
                </span>
              <% } %>
            </td>

            <!-- Applicants -->
            <td class="px-4 sm:px-6 py-4 text-center">
              <a href="/jobs/<%= job.id %>/applicants"
                 class="text-blue-600 hover:text-blue-800 transition"
                 title="View job applicants">
                <i class="fa-solid fa-eye text-lg"></i>
                <span class="ml-1 font-semibold"><%= job.Candidates ? job.Candidates.length : 0 %></span>
              </a>
            </td>

            <!-- Actions -->
            <td class="px-4 sm:px-6 py-4 text-center space-x-3 sm:space-x-4">
              <a href="/jobs/edit/<%= job.id %>"
                 class="text-green-600 hover:text-green-800 transition"
                 title="Edit job details">
                <i class="fa-solid fa-pen-to-square text-lg"></i>
              </a>
              <a href="/jobs/delete/<%= job.id %>"
                 class="text-red-600 hover:text-red-800 transition"
                 title="Delete this job"
                 onclick="return confirm('Are you sure you want to delete this job?');">
                <i class="fa-solid fa-trash text-lg"></i>
              </a>
            </td>
          </tr>

<!-- POPUP MODAL -->
<div id="modal-<%= job.id %>" 
     class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto">
  <div class="bg-white w-11/12 sm:w-4/5 md:w-2/3 lg:w-1/2 max-h-[85vh] p-4 sm:p-6 rounded-xl shadow-2xl relative animate-fadeIn overflow-y-auto">
    <h2 class="text-xl sm:text-2xl font-bold mb-4 text-gray-800 border-b pb-2">
      <%= job.title %>
    </h2>
    <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">
      <%= job.description %>
    </p>
    <button 
      class="absolute top-3 right-3 text-gray-500 hover:text-red-600"
      onclick="closeModal('<%= job.id %>')">
      <i class="fa-solid fa-xmark text-2xl"></i>
    </button>
  </div>
</div>

        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Script -->
<script>
  function openModal(id) {
    const modal = document.getElementById(`modal-${id}`);
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeModal(id) {
    const modal = document.getElementById(`modal-${id}`);
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  document.addEventListener('click', function (e) {
    if (e.target.classList.contains('bg-black')) {
      document.querySelectorAll('[id^="modal-"]').forEach(m => m.classList.add('hidden'));
    }
  });
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fadeIn {
    animation: fadeIn 0.3s ease-out;
  }
</style>

<%- include('../partials/footer') %>
