<%- include('../partials/header') %>


<main class="p-6 max-w-5xl mx-auto space-y-6">
  <h1 class="text-2xl font-bold">Review Uploaded Questions</h1>
  <p class="text-sm text-gray-600">Review parsed rows below. Fix your Excel and re-upload if there are errors.</p>

  <form action="/questions/confirmUpload" method="POST">
    <input type="hidden" name="tempFileName" value="<%= tempFileName %>" />
    <input type="hidden" name="testId" value="<%= testId %>" />

    <div class="grid grid-cols-1 gap-6">
      <% parsedRows.forEach(function(row, idx) { %>
        <div class="p-5 rounded-2xl shadow-lg bg-white/70 backdrop-blur-md border border-gray-200">
          <div class="flex justify-between items-start">
            <div>
              <div class="text-sm text-gray-500">Row: <%= row.rowNumber %></div>
              <h3 class="text-lg font-semibold text-gray-900 mt-1"><%= row.data.text || '(No question text)' %></h3>
              <div class="mt-2 text-sm text-gray-700">
                <div><strong>A:</strong> <%= row.data.optionA || '' %></div>
                <div><strong>B:</strong> <%= row.data.optionB || '' %></div>
                <div><strong>C:</strong> <%= row.data.optionC || '' %></div>
                <div><strong>D:</strong> <%= row.data.optionD || '' %></div>
              </div>
            </div>

            <div class="text-right">
              <div class="text-sm text-gray-600">Marks: <%= row.data.marks %></div>
              <div class="text-sm text-gray-600">Time: <%= row.data.timeLimit %>s</div>

              <% if (row.errors && row.errors.length > 0) { %>
                <div class="mt-3 inline-block px-3 py-1 rounded bg-red-100 text-red-700 font-medium">Errors</div>
              <% } else { %>
                <div class="mt-3 inline-block px-3 py-1 rounded bg-green-100 text-green-700 font-medium">Valid</div>
              <% } %>

              <div class="mt-3 text-sm">
                <strong>Correct:</strong> <span class="font-semibold"><%= row.data.correct || '-' %></span>
              </div>
            </div>
          </div>

          <% if (row.errors && row.errors.length > 0) { %>
            <div class="mt-4 p-3 bg-red-50 border border-red-100 rounded">
              <h4 class="text-sm font-semibold text-red-700 mb-2">Issues</h4>
              <ul class="list-disc list-inside text-sm text-red-700">
                <% row.errors.forEach(function(err) { %>
                  <li><%= err %></li>
                <% }) %>
              </ul>
            </div>
          <% } %>
        </div>
      <% }) %>
    </div>

    <div class="flex items-center justify-between mt-6">
      <a href="javascript:history.back()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded">Go Back / Re-upload</a>

      <% 
        // If any row has errors, disable Save button
        const hasErrors = parsedRows.some(r => r.errors && r.errors.length > 0);
      %>

      <% if (hasErrors) { %>
        <button type="button" disabled class="px-6 py-2 bg-gray-300 text-gray-500 rounded cursor-not-allowed">Fix errors to enable Save</button>
      <% } else { %>
        <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">Save All </button>
      <% } %>
    </div>
  </form>
</main>

<%- include('../partials/footer') %>
